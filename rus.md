# Декаданс и развращение `text-rendering: optimizeLegibility`

Слушайте, я возлюбил типографику как ближнего своего, может быть, даже немного
больше. Когда появилось CSS-свойство, которое обещало решить проблемы с лигатурами
и аккуратно рассчитанным кернингом, не каким-то дешёвым подобием — настоящим кернингом — 
я сразу бросился его изучать. Я добавил `text-rendering: optimizeLegibility` в
заголовки, тело статьи, ссылки. Даже изображениям добавил — просто на всякий
случай, например, если лигатура окажется на фоне фотографии, размытая, как
неприлично довольный полтергейст.

Нет, правда — это были дни типографского винегрета. Эра, напичканная лигатурами *fi*,
*fft* и покорившей моё сердце *st*. Буквы слова «вода» («water») так же плотно подгонялись
друг к другу, как капли воды в потоке, и я отчаянно искал причину написать AVAST в
верхнем регистре, чтобы посмотреть как будет написано слово с самым жутким
 кернингом из мне известных.

![Скриншот][Сравнение текста с разным значением свойства text-rendering]

*Разница между `text-rendering: optimizeLegibility` (слева) и `text-rendering: auto`
(справа) незначительна, даже если у вас изрядно наметан глаз.*

Однако подсознательно я понимаю, что новообретённые крылья сделвны из воска. Вся эта
типографская сила не дается за просто так: `text-rendering: optimizeLegibility`
— медленное свойство, и под «медленное» я подразумеваю, 
что оно способно «положить» всю страницу,
начиная от времени начального рендера и заканчивая временем перерисовки. Более
того, оно ещё и *глючное*: в частности, в Android [серьезные проблемы][2] при
рендеринге страниц, на которых активно используется свойство `optimizeLegibility`,
особенно в [старых его версиях][3], которые, к сожалению, всё ещё широко
распространены.

Глюки не имеют большого значения, а вот проблемы со скоростью — имеют. При расчёте
кернинга больших объемов текста могут возникать тысячи мелких вычислительных
процессов, и это создает серьёзную нагрузку на процессор. В современном
десктопном браузере, например в Chrome, ну, [всё не очень хорошо][4], 
а на мобильных с их ограниченными ресурсами это становится настоящим кошмаром, 
особенно когда в дело вступает `@font-face`. 
Вся работа при использовании свойства `optimizeLegibility` происходит 
ещё до того, как шрифт вообще можно отрендерить,
что выливается в чудовищно длительную [задержку в отрисовке текста][5] или
длительное [отображение текста шрифтом, предназначенным для мягкой деградации][6],
в зависимости от способа, которым подгружаются шрифты.

![Иллюстрация][Таймлайн отображения страницы с разным значением свойства text-rendering]

*Таймлайн отображения страницы при
медленном соединении, созданный с помощью [WebPageTest.org][8]. Единственное отличие между страницами — 
`p { text-rendering: optimizeLegibility; }` и `p { text-rendering: optimizeSpeed; }`*

Ключевым моментом, как вы, наверное, догадались, является умеренность. Использование
этих свойств на подзаголовках не нанесет серьёзного ущерба производительности.
По крайней мере, *заметного* ущерба.

На самом деле, и значение по умолчанию `text-rendering: auto` не оставляет
нас совсем без лигатур и с таким расстоянием между буквами, что
между ними и грузовик проедет. В Firefox (и, возможно, в скором времени
[WebKit][9] с Blink), `optimizeLegibility` включается для любого шрифта c
размером кегля `font-size: 20px` или более. На таких крупных надписях эффект
намного заметнее, и пара коротких строк текста не так уж сильно вредят
производительности, чтобы это можно было почувствовать.

Конечно, если мы хотим полностью отключить это свойство, всегда есть значение
`text-rendering: optimizeSpeed`, которое сработает вне зависимости от кегля
шрифта и полностью исключит любую нагрузку, которая связана с использованием
`text-rendering`. Я почти всегда предпочитаю оставлять значение по умолчанию
`text-rendering: auto`, но если вы работаете со страницей, на которой 
присутствует значительный объем текста со значением `font-size` 
больше `20px`, возможно, стоит попробовать `text-rendering: optimizeSpeed`.


 [Сравнение текста с разным значением свойства text-rendering]: img/text-render_zoom.png "Сравнение текста с разным значением свойства text-rendering"
 [Таймлайн отображения страницы с разным значением свойства text-rendering]: img/wpt-text.png "Таймлайн отображения страницы с разным значением свойства text-rendering"

 [2]: http://stackoverflow.com/search?q=%5Bandroid%5D+optimizelegibility
 [3]: https://code.google.com/p/android/issues/detail?id=15067
 [4]: http://www.webpagetest.org/video/compare.php?tests=150429_5K_ZPS%2C150429_7C_ZPT&thumbSize=200&ival=1000&end=visual
 [5]: http://www.filamentgroup.com/lab/font-loading.html
 [6]: http://www.filamentgroup.com/lab/font-events.html
 [8]: http://webpagetest.org
 [9]: https://bugs.webkit.org/show_bug.cgi?id=41363
